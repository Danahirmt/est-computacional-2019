<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.1 Funciones e iteración | Estadística Computacional</title>
  <meta name="description" content="Curso de estadística computacional, Maestría en Ciencia de Datos, ITAM 2019." />
  <meta name="generator" content="bookdown 0.13.1 and GitBook 2.6.7" />

  <meta property="og:title" content="4.1 Funciones e iteración | Estadística Computacional" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Curso de estadística computacional, Maestría en Ciencia de Datos, ITAM 2019." />
  <meta name="github-repo" content="tereom/est-computacional-2019" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.1 Funciones e iteración | Estadística Computacional" />
  
  <meta name="twitter:description" content="Curso de estadística computacional, Maestría en Ciencia de Datos, ITAM 2019." />
  

<meta name="author" content="María Teresa Ortiz" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="temas-selectos-de-r.html"/>
<link rel="next" href="tareas.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/toc.css" type="text/css" />
<link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" />
<link rel="stylesheet" href="css/cajas.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Estadística Computacional</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Información del curso</a><ul>
<li class="chapter" data-level="" data-path="temario.html"><a href="temario.html"><i class="fa fa-check"></i>Temario</a><ul>
<li class="chapter" data-level="" data-path="temario.html"><a href="temario.html#calificacion"><i class="fa fa-check"></i>Calificación</a></li>
<li class="chapter" data-level="" data-path="temario.html"><a href="temario.html#software"><i class="fa fa-check"></i>Software</a></li>
<li class="chapter" data-level="" data-path="temario.html"><a href="temario.html#otros-recursos"><i class="fa fa-check"></i>Otros recursos</a></li>
<li class="chapter" data-level="" data-path="temario.html"><a href="temario.html#noticias"><i class="fa fa-check"></i>Noticias</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="principios-visualizacion.html"><a href="principios-visualizacion.html"><i class="fa fa-check"></i><b>1</b> Principios visualización</a><ul>
<li class="chapter" data-level="1.1" data-path="introduccion.html"><a href="introduccion.html"><i class="fa fa-check"></i><b>1.1</b> Introducción</a><ul>
<li class="chapter" data-level="" data-path="introduccion.html"><a href="introduccion.html#visualizacion-de-datos-en-la-estadistica"><i class="fa fa-check"></i>Visualización de datos en la estadística</a></li>
<li class="chapter" data-level="" data-path="introduccion.html"><a href="introduccion.html#visualizacion-popular-de-datos"><i class="fa fa-check"></i>Visualización popular de datos</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="teoria-de-visualizacion-de-datos.html"><a href="teoria-de-visualizacion-de-datos.html"><i class="fa fa-check"></i><b>1.2</b> Teoría de visualización de datos</a></li>
<li class="chapter" data-level="1.3" data-path="factor-de-engano-y-chartjunk.html"><a href="factor-de-engano-y-chartjunk.html"><i class="fa fa-check"></i><b>1.3</b> Factor de engaño y Chartjunk</a></li>
<li class="chapter" data-level="1.4" data-path="pequenos-multiplos-y-densidad-grafica.html"><a href="pequenos-multiplos-y-densidad-grafica.html"><i class="fa fa-check"></i><b>1.4</b> Pequeños múltiplos y densidad gráfica</a></li>
<li class="chapter" data-level="1.5" data-path="tinta-de-datos.html"><a href="tinta-de-datos.html"><i class="fa fa-check"></i><b>1.5</b> Tinta de datos</a></li>
<li class="chapter" data-level="1.6" data-path="decoracion.html"><a href="decoracion.html"><i class="fa fa-check"></i><b>1.6</b> Decoración</a></li>
<li class="chapter" data-level="1.7" data-path="percepcion-de-escala.html"><a href="percepcion-de-escala.html"><i class="fa fa-check"></i><b>1.7</b> Percepción de escala</a></li>
<li class="chapter" data-level="1.8" data-path="ejemplos-grafica-de-minard.html"><a href="ejemplos-grafica-de-minard.html"><i class="fa fa-check"></i><b>1.8</b> Ejemplos: gráfica de Minard</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduccion-a-r-y-al-paquete-ggplot2.html"><a href="introduccion-a-r-y-al-paquete-ggplot2.html"><i class="fa fa-check"></i><b>2</b> Introducción a R y al paquete ggplot2</a><ul>
<li class="chapter" data-level="2.1" data-path="r-primeros-pasos.html"><a href="r-primeros-pasos.html"><i class="fa fa-check"></i><b>2.1</b> R: primeros pasos</a><ul>
<li class="chapter" data-level="" data-path="r-primeros-pasos.html"><a href="r-primeros-pasos.html#r-en-analisis-de-datos"><i class="fa fa-check"></i>R en análisis de datos</a></li>
<li class="chapter" data-level="" data-path="r-primeros-pasos.html"><a href="r-primeros-pasos.html#paquetes-y-el-tidyverse"><i class="fa fa-check"></i>Paquetes y el Tidyverse</a></li>
<li class="chapter" data-level="" data-path="r-primeros-pasos.html"><a href="r-primeros-pasos.html#recursos"><i class="fa fa-check"></i>Recursos</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="visualizacion-con-ggplot2.html"><a href="visualizacion-con-ggplot2.html"><i class="fa fa-check"></i><b>2.2</b> Visualización con ggplot2</a><ul>
<li class="chapter" data-level="" data-path="visualizacion-con-ggplot2.html"><a href="visualizacion-con-ggplot2.html#recursos-1"><i class="fa fa-check"></i>Recursos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="manipulacion-y-agrupacion-de-datos.html"><a href="manipulacion-y-agrupacion-de-datos.html"><i class="fa fa-check"></i><b>3</b> Manipulación y agrupación de datos</a><ul>
<li class="chapter" data-level="3.1" data-path="transformacion-de-datos.html"><a href="transformacion-de-datos.html"><i class="fa fa-check"></i><b>3.1</b> Transformación de datos</a><ul>
<li class="chapter" data-level="" data-path="transformacion-de-datos.html"><a href="transformacion-de-datos.html#datos"><i class="fa fa-check"></i>Datos</a></li>
<li class="chapter" data-level="" data-path="transformacion-de-datos.html"><a href="transformacion-de-datos.html#filtrar"><i class="fa fa-check"></i>Filtrar</a></li>
<li class="chapter" data-level="" data-path="transformacion-de-datos.html"><a href="transformacion-de-datos.html#seleccionar"><i class="fa fa-check"></i>Seleccionar</a></li>
<li class="chapter" data-level="" data-path="transformacion-de-datos.html"><a href="transformacion-de-datos.html#ordenar"><i class="fa fa-check"></i>Ordenar</a></li>
<li class="chapter" data-level="" data-path="transformacion-de-datos.html"><a href="transformacion-de-datos.html#mutar"><i class="fa fa-check"></i>Mutar</a></li>
<li class="chapter" data-level="" data-path="transformacion-de-datos.html"><a href="transformacion-de-datos.html#summarise-y-resumenes-por-grupo"><i class="fa fa-check"></i>Summarise y resúmenes por grupo</a></li>
<li class="chapter" data-level="" data-path="transformacion-de-datos.html"><a href="transformacion-de-datos.html#variables-por-grupo"><i class="fa fa-check"></i>Variables por grupo</a></li>
<li class="chapter" data-level="" data-path="transformacion-de-datos.html"><a href="transformacion-de-datos.html#verbos-de-dos-tablas"><i class="fa fa-check"></i>Verbos de dos tablas</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="datos-limpios.html"><a href="datos-limpios.html"><i class="fa fa-check"></i><b>3.2</b> Datos limpios</a><ul>
<li class="chapter" data-level="" data-path="datos-limpios.html"><a href="datos-limpios.html#limpieza-bases-de-datos"><i class="fa fa-check"></i>Limpieza bases de datos</a></li>
<li class="chapter" data-level="" data-path="datos-limpios.html"><a href="datos-limpios.html#los-encabezados-de-las-columanas-son-valores"><i class="fa fa-check"></i>Los encabezados de las columanas son valores</a></li>
<li class="chapter" data-level="" data-path="datos-limpios.html"><a href="datos-limpios.html#una-columna-asociada-a-mas-de-una-variable"><i class="fa fa-check"></i>Una columna asociada a más de una variable</a></li>
<li class="chapter" data-level="" data-path="datos-limpios.html"><a href="datos-limpios.html#variables-almacenadas-en-filas-y-columnas"><i class="fa fa-check"></i>Variables almacenadas en filas y columnas</a></li>
<li class="chapter" data-level="" data-path="datos-limpios.html"><a href="datos-limpios.html#una-misma-unidad-observacional-esta-almacenada-en-multiples-tablas"><i class="fa fa-check"></i>Una misma unidad observacional está almacenada en múltiples tablas</a></li>
<li class="chapter" data-level="" data-path="datos-limpios.html"><a href="datos-limpios.html#otras-consideraciones"><i class="fa fa-check"></i>Otras consideraciones</a></li>
<li class="chapter" data-level="" data-path="datos-limpios.html"><a href="datos-limpios.html#recursos-adicionales"><i class="fa fa-check"></i>Recursos adicionales</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="temas-selectos-de-r.html"><a href="temas-selectos-de-r.html"><i class="fa fa-check"></i><b>4</b> Temas selectos de R</a><ul>
<li class="chapter" data-level="4.1" data-path="funciones-e-iteracion.html"><a href="funciones-e-iteracion.html"><i class="fa fa-check"></i><b>4.1</b> Funciones e iteración</a><ul>
<li class="chapter" data-level="4.1.1" data-path="funciones-e-iteracion.html"><a href="funciones-e-iteracion.html#funciones"><i class="fa fa-check"></i><b>4.1.1</b> Funciones</a></li>
<li class="chapter" data-level="4.1.2" data-path="funciones-e-iteracion.html"><a href="funciones-e-iteracion.html#iteracion"><i class="fa fa-check"></i><b>4.1.2</b> Iteración</a></li>
<li class="chapter" data-level="" data-path="funciones-e-iteracion.html"><a href="funciones-e-iteracion.html#programacion-funcional"><i class="fa fa-check"></i>Programación funcional</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html"><i class="fa fa-check"></i>Tareas</a><ul>
<li class="chapter" data-level="" data-path="instalacion-y-visualizacion.html"><a href="instalacion-y-visualizacion.html"><i class="fa fa-check"></i>1. Instalación y visualización</a></li>
<li class="chapter" data-level="" data-path="transformacion-de-datos-1.html"><a href="transformacion-de-datos-1.html"><i class="fa fa-check"></i>2. Transformación de datos</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i>Referencias</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publicado con bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Estadística Computacional</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="funciones-e-iteracion" class="section level2">
<h2><span class="header-section-number">4.1</span> Funciones e iteración</h2>
<blockquote>
<p>“To understand computations in R, two slogans are helpful:<br />
* Everything that exists is an object.<br />
* Everything that happens is a function call.”<br />
— John Chambers</p>
</blockquote>
<div id="funciones" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Funciones</h3>
<p>En R todas las operaciones son producto de la llamada a una función, esto
incluye operaciones como <code>+</code>, operadores que controlan flujo como <code>for</code>, <code>if</code> y
<code>while</code>, e incluso operadores para obtener subconjuntos como <code>[ ]</code> y <code>$</code>.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb85-2" data-line-number="2">b &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb85-3" data-line-number="3">a <span class="op">+</span><span class="st"> </span>b</a>
<a class="sourceLine" id="cb85-4" data-line-number="4"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb85-5" data-line-number="5"><span class="st">`</span><span class="dt">+</span><span class="st">`</span>(a, b)</a>
<a class="sourceLine" id="cb85-6" data-line-number="6"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb85-7" data-line-number="7"></a>
<a class="sourceLine" id="cb85-8" data-line-number="8"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>) <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb85-9" data-line-number="9"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb85-10" data-line-number="10"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb85-11" data-line-number="11"><span class="st">`</span><span class="dt">for</span><span class="st">`</span>(i, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="kw">print</span>(i))</a>
<a class="sourceLine" id="cb85-12" data-line-number="12"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb85-13" data-line-number="13"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
<p>Para escribir código eficiente y fácil de leer es importante saber escribir
funciones, se dice que si hiciste <em>copy-paste</em> de una sección de tu código 3
o más veces es momento de escribir una función.</p>
<p>Escribimos una función para calcular un promedio ponderado:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1">wtd_mean &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">wt =</span> <span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">length</span>(x))) {</a>
<a class="sourceLine" id="cb86-2" data-line-number="2">  <span class="kw">sum</span>(x <span class="op">*</span><span class="st"> </span>wt) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(wt)</a>
<a class="sourceLine" id="cb86-3" data-line-number="3">}</a></code></pre></div>
<p>Notemos que esta función recibe hasta dos argumentos:</p>
<ol style="list-style-type: decimal">
<li><p><code>x</code>: el vector a partir del cual calcularemos el promedio y</p></li>
<li><p><code>wt</code>: un vector de <em>ponderadores</em> para cada componente del vector <code>x</code>.</p></li>
</ol>
<p>Notemos además que al segundo argumento le asignamos un valor predeterminado,
esto implica que si no especificamos los ponderadores la función usará el
valor predeterminado y promediara con mismo peso a todas las componentes.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1"><span class="kw">wtd_mean</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</a>
<a class="sourceLine" id="cb87-2" data-line-number="2"><span class="co">#&gt; [1] 5.5</span></a>
<a class="sourceLine" id="cb87-3" data-line-number="3"><span class="kw">wtd_mean</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb87-4" data-line-number="4"><span class="co">#&gt; [1] 4</span></a></code></pre></div>
<p>Veamos como escribir una función que reciba un vector y devuelva el mismo vector
centrado en cero.</p>
<ul>
<li>Comenzamos escribiendo el código para un caso particular, por ejemplo,
reescalando el vector <span class="math inline">\((0, 5, 10)\)</span>.</li>
</ul>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb88-2" data-line-number="2">vec <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(vec)</a>
<a class="sourceLine" id="cb88-3" data-line-number="3"><span class="co">#&gt; [1] -5  0  5</span></a></code></pre></div>
<p>Una vez que lo probamos lo convertimos en función:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1">center_vector &lt;-<span class="st"> </span><span class="cf">function</span>(vec) {</a>
<a class="sourceLine" id="cb89-2" data-line-number="2">  vec <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(vec)</a>
<a class="sourceLine" id="cb89-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb89-4" data-line-number="4"><span class="kw">center_vector</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb89-5" data-line-number="5"><span class="co">#&gt; [1] -5  0  5</span></a></code></pre></div>
<div id="ejercicio" class="section level4 unnumbered">
<h4>Ejercicio</h4>
<p><img src="img/manicule2.jpg" /> Escribe una función que reciba un vector y devuelva el
mismo vector reescalado al rango 0 a 1. Comienza escribiendo el código para un
caso particular, por ejemplo, empieza reescalando el vector
. Tip: la función <code>range()</code> devuelve el rango de un
vector.</p>
</div>
<div id="estructura-de-una-funcion" class="section level4 unnumbered">
<h4>Estructura de una función</h4>
<p>Las funciones de R tienen tres partes:</p>
<ol style="list-style-type: decimal">
<li>El cuerpo: el código dentro de la función</li>
</ol>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="kw">body</span>(wtd_mean)</a>
<a class="sourceLine" id="cb90-2" data-line-number="2"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb90-3" data-line-number="3"><span class="co">#&gt;     sum(x * wt)/sum(wt)</span></a>
<a class="sourceLine" id="cb90-4" data-line-number="4"><span class="co">#&gt; }</span></a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Los formales: la lista de argumentos que controlan como puedes llamar a la
función,</li>
</ol>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="kw">formals</span>(wtd_mean)</a>
<a class="sourceLine" id="cb91-2" data-line-number="2"><span class="co">#&gt; $x</span></a>
<a class="sourceLine" id="cb91-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb91-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb91-5" data-line-number="5"><span class="co">#&gt; $wt</span></a>
<a class="sourceLine" id="cb91-6" data-line-number="6"><span class="co">#&gt; rep(1, length(x))</span></a></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>El ambiente: el <em>mapeo</em> de la ubicación de las variables de la función, cómo
busca la función cada función el valor de las variables que usa.</li>
</ol>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="kw">environment</span>(wtd_mean)</a>
<a class="sourceLine" id="cb92-2" data-line-number="2"><span class="co">#&gt; &lt;environment: R_GlobalEnv&gt;</span></a></code></pre></div>
<p>Veamos mas ejemplos, ¿qué regresan las siguientes funciones?</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="co"># 1</span></a>
<a class="sourceLine" id="cb93-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb93-3" data-line-number="3">f &lt;-<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb93-4" data-line-number="4">  y &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb93-5" data-line-number="5">  <span class="kw">c</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y) </a>
<a class="sourceLine" id="cb93-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb93-7" data-line-number="7"><span class="kw">rm</span>(x, f)</a>
<a class="sourceLine" id="cb93-8" data-line-number="8"></a>
<a class="sourceLine" id="cb93-9" data-line-number="9"><span class="co"># 2</span></a>
<a class="sourceLine" id="cb93-10" data-line-number="10">x &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb93-11" data-line-number="11">g &lt;-<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb93-12" data-line-number="12">  x &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb93-13" data-line-number="13">  y &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb93-14" data-line-number="14">  <span class="kw">c</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)</a>
<a class="sourceLine" id="cb93-15" data-line-number="15">}</a>
<a class="sourceLine" id="cb93-16" data-line-number="16"><span class="kw">rm</span>(x, g)</a>
<a class="sourceLine" id="cb93-17" data-line-number="17"></a>
<a class="sourceLine" id="cb93-18" data-line-number="18"><span class="co"># 3</span></a>
<a class="sourceLine" id="cb93-19" data-line-number="19">x &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb93-20" data-line-number="20">h &lt;-<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb93-21" data-line-number="21">  y &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb93-22" data-line-number="22">  i &lt;-<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb93-23" data-line-number="23">    z &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb93-24" data-line-number="24">    <span class="kw">c</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">z =</span> z)</a>
<a class="sourceLine" id="cb93-25" data-line-number="25">  }</a>
<a class="sourceLine" id="cb93-26" data-line-number="26">  <span class="kw">i</span>() </a>
<a class="sourceLine" id="cb93-27" data-line-number="27">}</a>
<a class="sourceLine" id="cb93-28" data-line-number="28"></a>
<a class="sourceLine" id="cb93-29" data-line-number="29"><span class="co"># 4 ¿qué ocurre si la corremos por segunda vez?</span></a>
<a class="sourceLine" id="cb93-30" data-line-number="30">j &lt;-<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb93-31" data-line-number="31">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">exists</span>(<span class="st">&quot;a&quot;</span>)){</a>
<a class="sourceLine" id="cb93-32" data-line-number="32">    a &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb93-33" data-line-number="33">  } <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb93-34" data-line-number="34">    a &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span><span class="dv">1</span> </a>
<a class="sourceLine" id="cb93-35" data-line-number="35">}</a>
<a class="sourceLine" id="cb93-36" data-line-number="36">  <span class="kw">print</span>(a) </a>
<a class="sourceLine" id="cb93-37" data-line-number="37">}</a>
<a class="sourceLine" id="cb93-38" data-line-number="38">x &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb93-39" data-line-number="39">y &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb93-40" data-line-number="40"></a>
<a class="sourceLine" id="cb93-41" data-line-number="41"><span class="co"># 5 ¿qué regresa k()? ¿y k()()?</span></a>
<a class="sourceLine" id="cb93-42" data-line-number="42">k &lt;-<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb93-43" data-line-number="43">  x &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb93-44" data-line-number="44">  <span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb93-45" data-line-number="45">    y &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb93-46" data-line-number="46">    x <span class="op">+</span><span class="st"> </span>y </a>
<a class="sourceLine" id="cb93-47" data-line-number="47">  }</a>
<a class="sourceLine" id="cb93-48" data-line-number="48">}</a></code></pre></div>
<p>Las reglas de búsqueda determinan como se busca el valor de una variable libre
en una función. A nivel lenguaje R usa <em>lexical scoping</em>, esto implica que en R
los valores de los símbolos se basan en como se anidan las funciones cuando
fueron creadas y no en como son llamadas.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb94-2" data-line-number="2">  x <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb94-3" data-line-number="3">}</a></code></pre></div>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="kw">f</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb95-2" data-line-number="2"><span class="co">#&gt; Error in f(2): object &#39;y&#39; not found</span></a></code></pre></div>
<p>Si creamos el objeto <code>y</code>.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb96-2" data-line-number="2"><span class="kw">f</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb96-3" data-line-number="3"><span class="co">#&gt; [1] 3</span></a></code></pre></div>
<p>Como consecuencia de las reglas de búsqueda de R, todos los objetos deben ser
guardados en memoria y, si uno no es cuidadoso se pueden cometer errores
fácilmente.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb97-2" data-line-number="2"><span class="kw">f</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb97-3" data-line-number="3"><span class="co">#&gt; [1] 102</span></a></code></pre></div>
</div>
<div id="observaciones-del-uso-de-funciones" class="section level4 unnumbered">
<h4>Observaciones del uso de funciones</h4>
<ol style="list-style-type: decimal">
<li>Cuando llamamos a una función podemos especificar los argumentos en base a
posición, nombre completo o nombre parcial:</li>
</ol>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(abcdef, bcde1, bcde2) {</a>
<a class="sourceLine" id="cb98-2" data-line-number="2">  <span class="kw">c</span>(<span class="dt">a =</span> abcdef, <span class="dt">b1 =</span> bcde1, <span class="dt">b2 =</span> bcde2)</a>
<a class="sourceLine" id="cb98-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb98-4" data-line-number="4"><span class="co"># Posición</span></a>
<a class="sourceLine" id="cb98-5" data-line-number="5"><span class="kw">f</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb98-6" data-line-number="6"><span class="co">#&gt;  a b1 b2 </span></a>
<a class="sourceLine" id="cb98-7" data-line-number="7"><span class="co">#&gt;  1  2  3</span></a>
<a class="sourceLine" id="cb98-8" data-line-number="8"><span class="kw">f</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">abcdef =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb98-9" data-line-number="9"><span class="co">#&gt;  a b1 b2 </span></a>
<a class="sourceLine" id="cb98-10" data-line-number="10"><span class="co">#&gt;  1  2  3</span></a>
<a class="sourceLine" id="cb98-11" data-line-number="11"><span class="co"># Podemos abreviar el nombre de los argumentos</span></a>
<a class="sourceLine" id="cb98-12" data-line-number="12"><span class="kw">f</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">a =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb98-13" data-line-number="13"><span class="co">#&gt;  a b1 b2 </span></a>
<a class="sourceLine" id="cb98-14" data-line-number="14"><span class="co">#&gt;  1  2  3</span></a>
<a class="sourceLine" id="cb98-15" data-line-number="15"><span class="co"># Siempre y cuando la abreviación no sea ambigua</span></a>
<a class="sourceLine" id="cb98-16" data-line-number="16"><span class="kw">f</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dt">b =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb98-17" data-line-number="17"><span class="co">#&gt; Error in f(1, 3, b = 1): argument 3 matches multiple formal arguments</span></a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Los argumentos de las funciones en R se evalúan conforme se necesitan (<em>lazy
evaluation</em>),</li>
</ol>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(a, b){</a>
<a class="sourceLine" id="cb99-2" data-line-number="2">  a <span class="op">^</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb99-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb99-4" data-line-number="4"><span class="kw">f</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb99-5" data-line-number="5"><span class="co">#&gt; [1] 4</span></a></code></pre></div>
<p>La función anterior nunca utiliza el argumento <em>b</em>, de tal manera que <code>f(2)</code>
no produce ningún error.</p>
<ol start="3" style="list-style-type: decimal">
<li>Funciones con el mismo nombre en distintos paquetes:</li>
</ol>
<p>La función <code>filter()</code> (incluida en R base) aplica un filtro lineal a una serie
de tiempo de una variable.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">100</span></a>
<a class="sourceLine" id="cb100-2" data-line-number="2"><span class="kw">filter</span>(x, <span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb100-3" data-line-number="3"><span class="co">#&gt; Time Series:</span></a>
<a class="sourceLine" id="cb100-4" data-line-number="4"><span class="co">#&gt; Start = 1 </span></a>
<a class="sourceLine" id="cb100-5" data-line-number="5"><span class="co">#&gt; End = 100 </span></a>
<a class="sourceLine" id="cb100-6" data-line-number="6"><span class="co">#&gt; Frequency = 1 </span></a>
<a class="sourceLine" id="cb100-7" data-line-number="7"><span class="co">#&gt;   [1]  NA   6   9  12  15  18  21  24  27  30  33  36  39  42  45  48  51</span></a>
<a class="sourceLine" id="cb100-8" data-line-number="8"><span class="co">#&gt;  [18]  54  57  60  63  66  69  72  75  78  81  84  87  90  93  96  99 102</span></a>
<a class="sourceLine" id="cb100-9" data-line-number="9"><span class="co">#&gt;  [35] 105 108 111 114 117 120 123 126 129 132 135 138 141 144 147 150 153</span></a>
<a class="sourceLine" id="cb100-10" data-line-number="10"><span class="co">#&gt;  [52] 156 159 162 165 168 171 174 177 180 183 186 189 192 195 198 201 204</span></a>
<a class="sourceLine" id="cb100-11" data-line-number="11"><span class="co">#&gt;  [69] 207 210 213 216 219 222 225 228 231 234 237 240 243 246 249 252 255</span></a>
<a class="sourceLine" id="cb100-12" data-line-number="12"><span class="co">#&gt;  [86] 258 261 264 267 270 273 276 279 282 285 288 291 294 297  NA</span></a></code></pre></div>
<p>Ahora cargamos <code>dplyr</code>.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb101-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb101-3" data-line-number="3"><span class="co">#&gt; Attaching package: &#39;dplyr&#39;</span></a>
<a class="sourceLine" id="cb101-4" data-line-number="4"><span class="co">#&gt; The following objects are masked from &#39;package:stats&#39;:</span></a>
<a class="sourceLine" id="cb101-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb101-6" data-line-number="6"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb101-7" data-line-number="7"><span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span></a>
<a class="sourceLine" id="cb101-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb101-9" data-line-number="9"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb101-10" data-line-number="10"><span class="kw">filter</span>(x, <span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb101-11" data-line-number="11"><span class="co">#&gt; Error in UseMethod(&quot;filter_&quot;): no applicable method for &#39;filter_&#39; applied to an object of class &quot;c(&#39;integer&#39;, &#39;numeric&#39;)&quot;</span></a></code></pre></div>
<p>R tiene un conflicto en la función a llamar, nosotros requerimos usar
<code>filter</code> de stats y no la función <code>filter</code> de <code>dplyr</code>. R utiliza por default
la función que pertenece al último paquete que se cargó.</p>
<p>La función <code>search()</code> nos enlista los paquetes cargados y el orden.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="kw">search</span>()</a>
<a class="sourceLine" id="cb102-2" data-line-number="2"><span class="co">#&gt;  [1] &quot;.GlobalEnv&quot;        &quot;package:dplyr&quot;     &quot;package:forcats&quot;  </span></a>
<a class="sourceLine" id="cb102-3" data-line-number="3"><span class="co">#&gt;  [4] &quot;package:stringr&quot;   &quot;package:purrr&quot;     &quot;package:readr&quot;    </span></a>
<a class="sourceLine" id="cb102-4" data-line-number="4"><span class="co">#&gt;  [7] &quot;package:tidyr&quot;     &quot;package:tibble&quot;    &quot;package:ggplot2&quot;  </span></a>
<a class="sourceLine" id="cb102-5" data-line-number="5"><span class="co">#&gt; [10] &quot;package:tidyverse&quot; &quot;package:stats&quot;     &quot;package:graphics&quot; </span></a>
<a class="sourceLine" id="cb102-6" data-line-number="6"><span class="co">#&gt; [13] &quot;package:grDevices&quot; &quot;package:utils&quot;     &quot;package:datasets&quot; </span></a>
<a class="sourceLine" id="cb102-7" data-line-number="7"><span class="co">#&gt; [16] &quot;package:methods&quot;   &quot;Autoloads&quot;         &quot;package:base&quot;</span></a></code></pre></div>
<p>Una opción es especificar el paquete en la llamada de la función:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1">stats<span class="op">::</span><span class="kw">filter</span>(x, <span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb103-2" data-line-number="2"><span class="co">#&gt; Time Series:</span></a>
<a class="sourceLine" id="cb103-3" data-line-number="3"><span class="co">#&gt; Start = 1 </span></a>
<a class="sourceLine" id="cb103-4" data-line-number="4"><span class="co">#&gt; End = 100 </span></a>
<a class="sourceLine" id="cb103-5" data-line-number="5"><span class="co">#&gt; Frequency = 1 </span></a>
<a class="sourceLine" id="cb103-6" data-line-number="6"><span class="co">#&gt;   [1]  NA   6   9  12  15  18  21  24  27  30  33  36  39  42  45  48  51</span></a>
<a class="sourceLine" id="cb103-7" data-line-number="7"><span class="co">#&gt;  [18]  54  57  60  63  66  69  72  75  78  81  84  87  90  93  96  99 102</span></a>
<a class="sourceLine" id="cb103-8" data-line-number="8"><span class="co">#&gt;  [35] 105 108 111 114 117 120 123 126 129 132 135 138 141 144 147 150 153</span></a>
<a class="sourceLine" id="cb103-9" data-line-number="9"><span class="co">#&gt;  [52] 156 159 162 165 168 171 174 177 180 183 186 189 192 195 198 201 204</span></a>
<a class="sourceLine" id="cb103-10" data-line-number="10"><span class="co">#&gt;  [69] 207 210 213 216 219 222 225 228 231 234 237 240 243 246 249 252 255</span></a>
<a class="sourceLine" id="cb103-11" data-line-number="11"><span class="co">#&gt;  [86] 258 261 264 267 270 273 276 279 282 285 288 291 294 297  NA</span></a></code></pre></div>
<p>Como alternativa surge el paquete <a href="https://github.com/r-lib/conflicted">conflicted</a>
que alerta cuando hay conflictos y tiene funciones para especificar a que
paquete se desea dar preferencia en una sesión de R.</p>
</div>
</div>
<div id="iteracion" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Iteración</h3>
<p>En análisis de datos es común implementar rutinas iteraivas, esto es, cuando
debemos aplicar los mismos pasos a distintas entradas. Veremos que hay dos
paradigmas de iteración:</p>
<ol style="list-style-type: decimal">
<li><p>Programación imperativa: ciclos <code>for</code> y ciclos <code>while</code>.</p></li>
<li><p>Programación funcional: los ciclos se implmentan mediante funciones,</p></li>
</ol>
<p>La ventaja de la programación imperativa es que hacen la iteración de manera
clara, sin embargo, veremos que una vez que nos familiarizamos con el paradigma
de programación funcional, resulta en código más fácil de mantener y menos
propenso a errores.</p>
<div id="ciclos-for" class="section level4 unnumbered">
<h4>Ciclos for</h4>
<p>Supongamos que tenemos una base de datos y queremos calcular la media de sus
columnas numéricas.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>), <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">2</span>), <span class="dt">c =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">3</span>), </a>
<a class="sourceLine" id="cb104-2" data-line-number="2">    <span class="dt">d =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb104-3" data-line-number="3">df</a>
<a class="sourceLine" id="cb104-4" data-line-number="4"><span class="co">#&gt;    id             a         b         c        d</span></a>
<a class="sourceLine" id="cb104-5" data-line-number="5"><span class="co">#&gt; 1   1 -0.8961020922 2.3614407 3.7763403 5.827398</span></a>
<a class="sourceLine" id="cb104-6" data-line-number="6"><span class="co">#&gt; 2   2 -0.3672036639 1.5933740 2.5423686 5.848696</span></a>
<a class="sourceLine" id="cb104-7" data-line-number="7"><span class="co">#&gt; 3   3 -0.8945917353 2.2288593 2.9837629 5.326809</span></a>
<a class="sourceLine" id="cb104-8" data-line-number="8"><span class="co">#&gt; 4   4 -0.6813129302 3.8212095 0.1996257 4.859310</span></a>
<a class="sourceLine" id="cb104-9" data-line-number="9"><span class="co">#&gt; 5   5 -1.9474444910 0.5539005 3.9921969 4.615473</span></a>
<a class="sourceLine" id="cb104-10" data-line-number="10"><span class="co">#&gt; 6   6 -0.4016011490 3.1667075 4.3073651 3.711626</span></a>
<a class="sourceLine" id="cb104-11" data-line-number="11"><span class="co">#&gt; 7   7  0.3789739522 0.8661439 2.2237014 4.341076</span></a>
<a class="sourceLine" id="cb104-12" data-line-number="12"><span class="co">#&gt; 8   8 -0.1780694946 2.5360105 3.4996407 2.895908</span></a>
<a class="sourceLine" id="cb104-13" data-line-number="13"><span class="co">#&gt; 9   9 -0.0003728936 2.8044500 3.0558733 2.618737</span></a>
<a class="sourceLine" id="cb104-14" data-line-number="14"><span class="co">#&gt; 10 10 -1.8285193784 3.4844087 3.4000939 3.246748</span></a></code></pre></div>
<p>Podemos crear el código para cada columna pero esto involucra <em>copy-paste</em> y
no será muy práctico si aumenta el número de columnas:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1"><span class="kw">mean</span>(df<span class="op">$</span>a)</a>
<a class="sourceLine" id="cb105-2" data-line-number="2"><span class="co">#&gt; [1] -0.6816244</span></a>
<a class="sourceLine" id="cb105-3" data-line-number="3"><span class="kw">mean</span>(df<span class="op">$</span>b)</a>
<a class="sourceLine" id="cb105-4" data-line-number="4"><span class="co">#&gt; [1] 2.34165</span></a>
<a class="sourceLine" id="cb105-5" data-line-number="5"><span class="kw">mean</span>(df<span class="op">$</span>c)</a>
<a class="sourceLine" id="cb105-6" data-line-number="6"><span class="co">#&gt; [1] 2.998097</span></a>
<a class="sourceLine" id="cb105-7" data-line-number="7"><span class="kw">mean</span>(df<span class="op">$</span>d)</a>
<a class="sourceLine" id="cb105-8" data-line-number="8"><span class="co">#&gt; [1] 4.329178</span></a></code></pre></div>
<p>Con un ciclo <code>for</code> sería:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1">salida &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="dv">4</span>)  </a>
<a class="sourceLine" id="cb106-2" data-line-number="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {            </a>
<a class="sourceLine" id="cb106-3" data-line-number="3">  salida[[i]] &lt;-<span class="st"> </span><span class="kw">mean</span>(df[[i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>]])      </a>
<a class="sourceLine" id="cb106-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb106-5" data-line-number="5">salida</a>
<a class="sourceLine" id="cb106-6" data-line-number="6"><span class="co">#&gt; [1] -0.6816244  2.3416505  2.9980969  4.3291781</span></a></code></pre></div>
<p>Los ciclos <code>for</code> tienen 3 componentes:</p>
<ol style="list-style-type: decimal">
<li><p>La salida: <code>salida &lt;- vector(&quot;double&quot;, 4)</code>. Es importante especificar el
tamaño de la salida antes de iniciar el ciclo <code>for</code>, de lo contrario el código
puede ser muy lento.</p></li>
<li><p>La secuencia: determina sobre que será la iteración, la función <code>seq_along</code>
puede resultar útil.</p></li>
</ol>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1">salida &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="dv">5</span>)  </a>
<a class="sourceLine" id="cb107-2" data-line-number="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {            </a>
<a class="sourceLine" id="cb107-3" data-line-number="3">  salida[[i]] &lt;-<span class="st"> </span><span class="kw">mean</span>(df[[i]])      </a>
<a class="sourceLine" id="cb107-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb107-5" data-line-number="5"><span class="kw">seq_along</span>(df)</a>
<a class="sourceLine" id="cb107-6" data-line-number="6"><span class="co">#&gt; [1] 1 2 3 4 5</span></a></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>El cuerpo: <code>salida[[i]] &lt;- mean(df[[i]])</code>, el código que calcula lo que nos
interesa sobre cada objeto en la iteración.</li>
</ol>
</div>
<div id="ejercicio-1" class="section level4 unnumbered">
<h4>Ejercicio</h4>
<ul>
<li>Calcula el número de valores únicos en cada columna de los datos <code>iris</code>.</li>
</ul>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1"><span class="kw">head</span>(iris)</a>
<a class="sourceLine" id="cb108-2" data-line-number="2"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb108-3" data-line-number="3"><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb108-4" data-line-number="4"><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb108-5" data-line-number="5"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb108-6" data-line-number="6"><span class="co">#&gt; 4          4.6         3.1          1.5         0.2  setosa</span></a>
<a class="sourceLine" id="cb108-7" data-line-number="7"><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb108-8" data-line-number="8"><span class="co">#&gt; 6          5.4         3.9          1.7         0.4  setosa</span></a></code></pre></div>
<ul>
<li>Recordando la limpieza de datos de la sección anterior en uno de los
últimos ejercicios leíamos archivos de manera iteativa. En este ejercicio
descargaremos un archivo zip con archivos csv que contienen información
de monitoreo de contaminantes en ciudad de México (<a href="http://www.aire.cdmx.gob.mx/default.php?opc=%27aKBh%27">RAMA</a>), en particular
PM2.5. Y juntaremos la información en una sola tabla, la siguiente instrucción
descarga los datos en una carpeta <code>data</code>.</li>
</ul>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="kw">library</span>(usethis)</a>
<a class="sourceLine" id="cb109-2" data-line-number="2"><span class="kw">use_directory</span>(<span class="st">&quot;data&quot;</span>) <span class="co"># crea carpeta en caso de que no exista ya</span></a>
<a class="sourceLine" id="cb109-3" data-line-number="3">usethis<span class="op">::</span><span class="kw">use_zip</span>(<span class="st">&quot;https://github.com/tereom/estcomp/raw/master/data-raw/19RAMA.zip&quot;</span>, </a>
<a class="sourceLine" id="cb109-4" data-line-number="4">    <span class="st">&quot;data&quot;</span>) <span class="co"># descargar y descomprimir zip</span></a></code></pre></div>
<ul>
<li>Enlistamos los archivos xls en la carpeta.</li>
</ul>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1">paths &lt;-<span class="st"> </span><span class="kw">dir</span>(<span class="st">&quot;data/19RAMA&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.xls$&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="img/manicule2.jpg" /> Tu turno, implementa un ciclo <code>for</code> para leer los
archivos y crear una única tabla de datos.</p>
</div>
</div>
<div id="programacion-funcional" class="section level3 unnumbered">
<h3>Programación funcional</h3>
<p>Ahora veremos como abordar iteración usando programación funcional.</p>
<p>Regresando al ejemplo inicial de calcular la media de las columnas de una
tabla de datos:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1">salida &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="dv">4</span>) </a>
<a class="sourceLine" id="cb111-2" data-line-number="2"></a>
<a class="sourceLine" id="cb111-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {            </a>
<a class="sourceLine" id="cb111-4" data-line-number="4">  salida[[i]] &lt;-<span class="st"> </span><span class="kw">mean</span>(df[[i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>]])      </a>
<a class="sourceLine" id="cb111-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb111-6" data-line-number="6">salida</a>
<a class="sourceLine" id="cb111-7" data-line-number="7"><span class="co">#&gt; [1] -0.6816244  2.3416505  2.9980969  4.3291781</span></a></code></pre></div>
<p>Podemos crear una función que calcula la media de las columnas de un
<code>data.frame</code>:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1">col_media &lt;-<span class="st"> </span><span class="cf">function</span>(df) {</a>
<a class="sourceLine" id="cb112-2" data-line-number="2">  salida &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">length</span>(df))</a>
<a class="sourceLine" id="cb112-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {</a>
<a class="sourceLine" id="cb112-4" data-line-number="4">    salida[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(df[[i]])</a>
<a class="sourceLine" id="cb112-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb112-6" data-line-number="6">  salida</a>
<a class="sourceLine" id="cb112-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb112-8" data-line-number="8"><span class="kw">col_media</span>(df)</a>
<a class="sourceLine" id="cb112-9" data-line-number="9"><span class="co">#&gt; [1]  5.5000000 -0.6816244  2.3416505  2.9980969  4.3291781</span></a>
<a class="sourceLine" id="cb112-10" data-line-number="10"><span class="kw">col_media</span>(<span class="kw">select</span>(iris, <span class="op">-</span>Species))</a>
<a class="sourceLine" id="cb112-11" data-line-number="11"><span class="co">#&gt; [1] 5.843333 3.057333 3.758000 1.199333</span></a></code></pre></div>
<p>Y podemos extender a crear más funciones que describan los datos:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1">col_mediana &lt;-<span class="st"> </span><span class="cf">function</span>(df) {</a>
<a class="sourceLine" id="cb113-2" data-line-number="2">  salida &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">length</span>(df))</a>
<a class="sourceLine" id="cb113-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {</a>
<a class="sourceLine" id="cb113-4" data-line-number="4">    salida[i] &lt;-<span class="st"> </span><span class="kw">median</span>(df[[i]])</a>
<a class="sourceLine" id="cb113-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb113-6" data-line-number="6">  salida</a>
<a class="sourceLine" id="cb113-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb113-8" data-line-number="8">col_sd &lt;-<span class="st"> </span><span class="cf">function</span>(df) {</a>
<a class="sourceLine" id="cb113-9" data-line-number="9">  salida &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">length</span>(df))</a>
<a class="sourceLine" id="cb113-10" data-line-number="10">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {</a>
<a class="sourceLine" id="cb113-11" data-line-number="11">    salida[i] &lt;-<span class="st"> </span><span class="kw">sd</span>(df[[i]])</a>
<a class="sourceLine" id="cb113-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb113-13" data-line-number="13">  salida</a>
<a class="sourceLine" id="cb113-14" data-line-number="14">}</a></code></pre></div>
<p>Podemos hacer nuestro código más general y compacto escribiendo una función
que reciba los datos sobre los que queremos iterar y la función que queremos
aplicar:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1">col_describe &lt;-<span class="st"> </span><span class="cf">function</span>(df, fun) {</a>
<a class="sourceLine" id="cb114-2" data-line-number="2">  salida &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">length</span>(df))</a>
<a class="sourceLine" id="cb114-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {</a>
<a class="sourceLine" id="cb114-4" data-line-number="4">    salida[i] &lt;-<span class="st"> </span><span class="kw">fun</span>(df[[i]])</a>
<a class="sourceLine" id="cb114-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb114-6" data-line-number="6">  salida</a>
<a class="sourceLine" id="cb114-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb114-8" data-line-number="8"><span class="kw">col_describe</span>(df, median)</a>
<a class="sourceLine" id="cb114-9" data-line-number="9"><span class="co">#&gt; [1]  5.500000 -0.541457  2.448726  3.227984  4.478275</span></a>
<a class="sourceLine" id="cb114-10" data-line-number="10"><span class="kw">col_describe</span>(df, mean)</a>
<a class="sourceLine" id="cb114-11" data-line-number="11"><span class="co">#&gt; [1]  5.5000000 -0.6816244  2.3416505  2.9980969  4.3291781</span></a></code></pre></div>
<p>Ahora utilizaremos esta idea de pasar funciones a funciones para eliminar los
ciclos <code>for</code>.</p>
<p>La iteración a través de funciones es muy común en R, hay funciones para hacer
esto en R base (<code>lapply()</code>, <code>apply()</code>, <code>sapply()</code>). Nosotros utilizaremos las
funciones del paquete <code>purrr</code>,</p>
<p>La familia de funciones del paquete iteran siempre sobre un vector (vector
atómico o lista), aplican una
función a cada parte y regresan un nuevo vector de la misma longitud que el
vector entrada. Cada función especifica en su nombre el tipo de salida:</p>
<ul>
<li><code>map()</code> devuelve una lista.</li>
<li><code>map_lgl()</code> devuelve un vector lógico.</li>
<li><code>map_int()</code> devuelve un vector entero.</li>
<li><code>map_dbl()</code> devuelve un vector double.</li>
<li><code>map_chr()</code> devuelve un vector caracter.</li>
</ul>
<p>En el ejemplo de las medias, <code>map</code> puede recibir un <code>data.frame</code> (lista de
vectores) y aplicará las funciones a las columnas del mismo.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb115-2" data-line-number="2"><span class="kw">map_dbl</span>(df, mean)</a>
<a class="sourceLine" id="cb115-3" data-line-number="3"><span class="co">#&gt;         id          a          b          c          d </span></a>
<a class="sourceLine" id="cb115-4" data-line-number="4"><span class="co">#&gt;  5.5000000 -0.6816244  2.3416505  2.9980969  4.3291781</span></a>
<a class="sourceLine" id="cb115-5" data-line-number="5"><span class="kw">map_dbl</span>(<span class="kw">select</span>(iris, <span class="op">-</span>Species), median)</a>
<a class="sourceLine" id="cb115-6" data-line-number="6"><span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width </span></a>
<a class="sourceLine" id="cb115-7" data-line-number="7"><span class="co">#&gt;         5.80         3.00         4.35         1.30</span></a></code></pre></div>
<p>Usaremos <code>map</code> para ajustar un modelo lineal a subconjuntos de los datos
<code>mtcars</code> determinados por el cilindraje del motor.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1">models &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb116-2" data-line-number="2"><span class="st">  </span><span class="kw">split</span>(.<span class="op">$</span>cyl) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb116-3" data-line-number="3"><span class="st">  </span><span class="kw">map</span>(<span class="cf">function</span>(df) <span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> df))</a></code></pre></div>
<p>Podemos usar la notación <code>.</code> para hacer código más corto:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1">models &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb117-2" data-line-number="2"><span class="st">  </span><span class="kw">split</span>(.<span class="op">$</span>cyl) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb117-3" data-line-number="3"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> .))</a></code></pre></div>
<p>Usemos <code>map_**</code> para unir tablas de datos que están almacenadas en múltiples
archivos csv.</p>
<p>En este caso es más apropiado usar map_df</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb118-2" data-line-number="2">rama &lt;-<span class="st"> </span><span class="kw">map_df</span>(paths, read_excel, <span class="dt">.id =</span> <span class="st">&quot;FILENAME&quot;</span>)</a></code></pre></div>
<div id="ejercicio-2" class="section level4 unnumbered">
<h4>Ejercicio</h4>
<ul>
<li><p>Usa la función <code>map_**</code> para calcular el número de valores únicos en las
columnas de <code>iris</code>.</p></li>
<li><p>Usa la función <code>map_**</code> para extraer el coeficiete de la variable <code>wt</code> para
cada modelo:</p></li>
</ul>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1">models[[<span class="dv">1</span>]]<span class="op">$</span>coefficients[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb119-2" data-line-number="2"><span class="co">#&gt;        wt </span></a>
<a class="sourceLine" id="cb119-3" data-line-number="3"><span class="co">#&gt; -5.647025</span></a></code></pre></div>
<ul>
<li>Utiliza map_*** para crear un vector con la media de
nitrato de cada estación de monitoreo, itera sobre el vector <code>specdata_us_vec</code>.</li>
</ul>

</div>
</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="temas-selectos-de-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tareas.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/tereom/est-computacional-2019/edit/master/03-temas_selectos_r.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
